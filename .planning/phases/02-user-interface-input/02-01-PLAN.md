---
phase: 02-user-interface-input
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - public/index.html
  - server.js
autonomous: true

must_haves:
  truths:
    - "User can select a baseline template from dropdown"
    - "User can type natural language request in text box (1000+ characters without lag)"
    - "Clicking Generate button shows loading spinner and disables controls"
    - "After generation, success message appears with download link"
    - "Clicking download link triggers .mt file download with template-name-timestamp filename"
  artifacts:
    - path: "public/index.html"
      provides: "Complete UI with dropdown, text input, generate button, loading state, download"
      contains: "textarea"
    - path: "server.js"
      provides: "Generate endpoint returning baseline template"
      contains: "app.post('/api/generate'"
  key_links:
    - from: "public/index.html"
      to: "/api/generate"
      via: "fetch POST on button click"
      pattern: "fetch.*api/generate.*POST"
    - from: "public/index.html"
      to: "/api/templates/:id"
      via: "fetch GET when dropdown changes"
      pattern: "fetch.*api/templates/"
---

<objective>
Add complete user interface for template generation with natural language input.

Purpose: Enable users to describe template changes and trigger generation with visual feedback.
Output: Working UI where user can select template, enter request, click generate, and download result.
</objective>

<execution_context>
This plan should be executed directly - it contains all instructions needed.
</execution_context>

<context>
Existing codebase:
- server.js has Express app with GET /api/templates and GET /api/templates/:id
- public/index.html has dropdown that loads templates from API
- templates/ folder has 3 baseline .mt files (minimal, standard, complex)

Live at: https://mx-template-generator-production.up.railway.app
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add generate endpoint to server</name>
  <files>server.js</files>
  <action>
Add JSON body parsing middleware at the top (after express.static):
```javascript
app.use(express.json());
```

Add POST /api/generate endpoint before the root route:
```javascript
// POST /api/generate - Generate modified template (stub - returns baseline for now)
app.post('/api/generate', (req, res) => {
  try {
    const { templateId, request } = req.body;

    // Validate inputs
    if (!templateId) {
      return res.status(400).json({ error: 'Template ID is required' });
    }

    // Load the baseline template
    const filePath = path.join(__dirname, 'templates', `${templateId}.mt`);
    if (!fs.existsSync(filePath)) {
      return res.status(404).json({ error: 'Template not found' });
    }

    const fileContent = fs.readFileSync(filePath, 'utf8');
    const templateData = JSON.parse(fileContent);

    // TODO: Phase 3-4 will add NLP processing here
    // For now, just return the baseline template unchanged

    // Generate filename with template name and timestamp
    const timestamp = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
    const filename = `${templateId}-${timestamp}.mt`;

    res.json({
      success: true,
      filename: filename,
      template: templateData
    });
  } catch (error) {
    console.error('Error generating template:', error);
    res.status(500).json({ error: 'Failed to generate template' });
  }
});
```
  </action>
  <verify>
Run: `curl -X POST http://localhost:3000/api/generate -H "Content-Type: application/json" -d '{"templateId":"baseline-minimal","request":"test"}' | head -c 200`
Should return JSON with success:true, filename, and template object.
  </verify>
  <done>POST /api/generate returns baseline template with generated filename</done>
</task>

<task type="auto">
  <name>Task 2: Update frontend with complete UI</name>
  <files>public/index.html</files>
  <action>
Replace the entire index.html with a complete UI that includes:

1. **Dropdown** (already exists) - keep the template selector
2. **Template info display** - show selected template's title/description below dropdown
3. **Text area** - large input for natural language request (placeholder: "Describe the changes you want...")
4. **Generate button** - styled button that triggers generation
5. **Loading state** - spinner and "Generating..." text, disable all inputs during generation
6. **Result area** - success message with download link, or error message

Key implementation details:
- Text area: min-height 150px, resize vertical, placeholder text
- Button: styled with hover state, disabled state styling
- Loading: use CSS spinner animation, hide/show with JS
- Download: create blob URL from template JSON, trigger download with generated filename
- Error handling: display error messages in red text

CSS requirements:
- Form inputs full width with padding and border-radius
- Button: background #007bff, white text, hover darker, disabled gray
- Loading spinner: CSS-only animation
- Success message: green text with download link
- Error message: red text

JavaScript flow:
1. On dropdown change: fetch template details, show title/description
2. On generate click:
   - Validate: template selected + request entered
   - Disable all inputs, show loading spinner
   - POST to /api/generate with templateId and request
   - On success: hide spinner, show success message with download link
   - On error: hide spinner, show error message
   - Re-enable inputs
3. Download link: create Blob from JSON, URL.createObjectURL, trigger click on hidden anchor
  </action>
  <verify>
1. Open http://localhost:3000 in browser
2. Select a template - should show template info
3. Enter text in request box - should accept 1000+ characters without lag
4. Click Generate - should show spinner, then success message
5. Click Download - should download .mt file with correct filename
  </verify>
  <done>
- Dropdown shows 3 templates and displays selected template info
- Text area accepts long text without lag
- Generate button shows loading state during API call
- Success message shows with working download link
- Downloaded file has correct name format (templateId-YYYY-MM-DD.mt)
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete template generator UI with dropdown, text input, generate button, loading state, and file download</what-built>
  <how-to-verify>
1. Visit http://localhost:3000 (or the Railway URL after deploy)
2. Select "Standard" from dropdown - verify template info appears
3. Type a long paragraph in the text box (100+ words) - verify no lag
4. Click "Generate" button:
   - Verify button shows "Generating..." with spinner
   - Verify dropdown and text area are disabled during generation
5. After generation completes:
   - Verify success message appears
   - Click download link
   - Verify file downloads with name like "baseline-standard-2026-02-18.mt"
   - Open downloaded file - verify it contains valid JSON
6. Test error case: Clear the text area and click Generate - verify error message appears
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. Server starts without errors: `npm start`
2. API endpoint works: `curl -X POST localhost:3000/api/generate -H "Content-Type: application/json" -d '{"templateId":"baseline-minimal","request":"test"}'`
3. All UI elements present and functional
4. Loading state visible during generation
5. Download produces valid .mt file
</verification>

<success_criteria>
- User can select template from dropdown and see its info displayed
- User can type 1000+ character request without UI lag
- Generate button shows loading state during API call
- Success message appears with working download link
- Downloaded .mt file has correct filename format and valid JSON content
- Error messages display for invalid inputs
</success_criteria>

<output>
After completion, create `.planning/phases/02-user-interface-input/02-01-SUMMARY.md`
</output>
