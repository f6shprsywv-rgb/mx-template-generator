# Test Scenarios for MasterControl Mx Template Import Testing

## Purpose

Validate that templates generated by the mx-template-generator successfully import into MasterControl Mx production system and function correctly.

## Testing Environment

- **Generator URL:** https://mx-template-generator-production.up.railway.app/
- **Target System:** MasterControl Mx (production or test environment)
- **Template Import:** Via Mx UI file upload

---

## Test Categories

### Category 1: Basic Clone Tests

These tests verify that cloning templates without modifications produces valid .mt files with unique UUIDs.

#### Test 1.1: Clone baseline-minimal

**Input:**
- Template: `baseline-minimal`
- Modification request: (empty)

**Expected Output:**
- Valid JSON structure
- All UUIDs regenerated (different from source template)
- ISA-88 hierarchy preserved:
  - PROCEDURE → UNIT_PROCEDURE → OPERATION → PHASE → PHASE_STEP
- File downloads as `.mt` file

**Verification Steps:**
1. Select "Baseline Minimal" from dropdown
2. Leave modification field empty
3. Click "Generate Template"
4. Download file
5. Open file in text editor - verify it's valid JSON
6. Check `masterTemplateDetails.productId` has new UUID
7. Import to MasterControl Mx
8. Confirm: Import succeeds without errors

**Success Criteria:** Import successful, template visible in Mx

---

#### Test 1.2: Clone baseline-simple

**Input:**
- Template: `baseline-simple`
- Modification request: (empty)

**Expected Output:**
- Valid JSON structure
- All UUIDs regenerated
- ISA-88 hierarchy preserved
- Baseline-simple structure intact (1 Unit Procedure, 1 Operation, 1 Phase with DATA_ENTRY step)

**Verification Steps:**
1. Select "Baseline Simple" from dropdown
2. Leave modification field empty
3. Click "Generate Template"
4. Download file
5. Import to MasterControl Mx
6. Open imported template in Mx
7. Verify structure matches expected hierarchy

**Success Criteria:** Import successful, structure intact

---

#### Test 1.3: Clone baseline-standard

**Input:**
- Template: `baseline-standard`
- Modification request: (empty)

**Expected Output:**
- Valid JSON structure
- All UUIDs regenerated
- More complex ISA-88 hierarchy preserved
- All phases, operations, and steps intact

**Verification Steps:**
1. Select "Baseline Standard" from dropdown
2. Leave modification field empty
3. Click "Generate Template"
4. Download file
5. Import to MasterControl Mx
6. Verify all original phases present

**Success Criteria:** Import successful, all original content preserved

---

### Category 2: Simple Modification Tests

These tests verify that AI modifications produce valid templates that import correctly.

#### Test 2.1: Add single phase (basic)

**Input:**
- Template: `baseline-simple`
- Modification request: `add phase Quality Check`

**Expected Output:**
- Original phase preserved
- New "Quality Check" phase added
- New phase has:
  - Correct ISA-88 level (PHASE)
  - Proper parentId reference to Operation
  - Required dataCaptureSteps (STRUCTURE_COMPLETE, TRAINING_OVERRIDE, PHASE_COMPLETE_BUTTON, PREDECESSOR_OVERRIDE)
  - ITERATION_REVIEW PHASE_STEP with standard dataCaptureSteps

**Verification Steps:**
1. Select "Baseline Simple" from dropdown
2. Enter: `add phase Quality Check`
3. Click "Generate Template"
4. Download file
5. Open in text editor
6. Search for "Quality Check" - verify it exists
7. Verify Quality Check has correct structure
8. Import to MasterControl Mx
9. Open imported template
10. Verify "Quality Check" phase is visible and functional

**Success Criteria:**
- Import successful
- "Quality Check" phase visible in Mx
- Phase is navigable and usable

---

#### Test 2.2: Add phase with witness sign-off

**Input:**
- Template: `baseline-simple`
- Modification request: `add phase Verification with witness`

**Expected Output:**
- New "Verification" phase added
- Phase includes WITNESS sign-off in ITERATION_REVIEW
- SIGN_OFF dataCaptureStep with `signOffType: "WITNESS"`

**Verification Steps:**
1. Select "Baseline Simple"
2. Enter: `add phase Verification with witness`
3. Generate and download
4. Search JSON for "Verification" phase
5. Verify ITERATION_REVIEW contains SIGN_OFF with signOffType: "WITNESS"
6. Import to Mx
7. Open phase in Mx
8. Confirm witness sign-off field is present

**Success Criteria:**
- Import successful
- Witness sign-off functional in Mx UI

---

#### Test 2.3: Add phase with multiple sign-offs

**Input:**
- Template: `baseline-simple`
- Modification request: `add phase Final Review with witness and verify`

**Expected Output:**
- New "Final Review" phase added
- Phase includes both WITNESS and VERIFY sign-offs
- Two SIGN_OFF dataCaptureSteps in ITERATION_REVIEW

**Verification Steps:**
1. Select "Baseline Simple"
2. Enter: `add phase Final Review with witness and verify`
3. Generate and download
4. Search JSON for both sign-off types
5. Import to Mx
6. Verify both sign-off fields present and functional

**Success Criteria:**
- Import successful
- Both witness and verify sign-offs work

---

### Category 3: Complex Modification Tests

These tests verify AI can modify larger, more complex templates.

#### Test 3.1: Modify complex template

**Input:**
- Template: `baseline-ysvod`
- Modification request: `add phase Equipment Check`

**Expected Output:**
- Larger baseline template preserved
- New phase added to existing multi-phase structure
- All existing phases intact

**Verification Steps:**
1. Select "Baseline YSVOD"
2. Enter: `add phase Equipment Check`
3. Generate and download
4. Verify file size is reasonable (not corrupted)
5. Count phases in JSON - should be original count + 1
6. Import to Mx
7. Verify all phases present including new one

**Success Criteria:**
- Import successful
- No existing phases damaged
- New phase functional

---

#### Test 3.2: Multiple modifications (if supported)

**Input:**
- Template: `baseline-simple`
- Modification request: `add phase Quality Check and add phase Final Review`

**Expected Output:**
- Two new phases added
- Both phases structured correctly

**Verification Steps:**
1. Select "Baseline Simple"
2. Enter multi-phase request
3. Generate and download
4. Verify both phases exist in JSON
5. Import to Mx
6. Confirm both phases visible

**Success Criteria:**
- Import successful
- Both phases functional
- OR: System provides clear error if multiple additions not supported

---

### Category 4: Edge Cases and Error Handling

These tests verify error handling and edge case behavior.

#### Test 4.1: Empty modification (explicit clone)

**Input:**
- Template: `baseline-simple`
- Modification request: (empty)

**Expected Output:**
- Template cloned with new UUIDs
- No structural changes
- AI graceful fallback activated

**Verification Steps:**
1. Select template
2. Leave modification empty
3. Generate
4. Verify AI status message (should indicate fallback or simple clone)
5. Import to Mx

**Success Criteria:** Import successful, matches original structure

---

#### Test 4.2: Invalid template selection

**Input:**
- Template: (none selected or invalid)
- Modification request: `add phase Test`

**Expected Output:**
- Error message displayed
- No download initiated
- User-friendly error text

**Verification Steps:**
1. Attempt to generate without selecting template
2. Observe error handling

**Success Criteria:** Clear error message, no crash

---

#### Test 4.3: AI timeout handling

**Input:**
- Template: `baseline-ysvod` (large template)
- Modification request: Complex modification

**Expected Output:**
- If AI times out (60s), fallback to clone with new UUIDs
- User message indicates timeout
- Template still downloads

**Verification Steps:**
1. Select large template
2. Request complex modification
3. Wait for response
4. Note whether AI timeout occurs
5. Verify template still usable

**Success Criteria:** Even with timeout, template imports successfully

---

## Critical Verification Points

For **every** test, verify the following in imported templates:

### 1. UUID Uniqueness
- No duplicate UUIDs across entire JSON
- `productId` is unique
- All `id`, `globalSerialId` fields are unique

### 2. ISA-88 Hierarchy Integrity
- Proper parent-child relationships
- Correct `parentId` references
- Proper `level` values (PROCEDURE, UNIT_PROCEDURE, OPERATION, PHASE, PHASE_STEP, SUB_PHASE_STEP)

### 3. Required Fields for PHASE Nodes
- `dataCaptureSteps` array present
- Required dataCaptureStep types: STRUCTURE_COMPLETE, TRAINING_OVERRIDE, PHASE_COMPLETE_BUTTON, PREDECESSOR_OVERRIDE
- ITERATION_REVIEW PHASE_STEP present

### 4. Known Potential Gaps (from ANALYSIS.md)

These fields may be missing and could cause import failures:

#### On DATA_ENTRY PHASE_STEP nodes:
```json
"structureDisplay": {
  "structureId": <id>,
  "displayOrderNumber": 1
}
```

#### On DATA_ENTRY steps:
- CORRECTION child (SUB_PHASE_STEP) with correctionType: "PRIMARY_DATA_ENTRY"
- Three dataCaptureSteps: CORRECTION_START, CORRECTION_END, CORRECTION_CANCEL

#### dataCaptureStep proper types:
- GENERAL_TEXT (not just "text")
- GENERAL_NUMERIC (not just "numeric")
- NOTES
- SIGN_OFF with proper signOffType

---

## Test Execution Template

For each test, record:

```
Test ID: [e.g., 1.1]
Test Name: [e.g., Clone baseline-minimal]
Date/Time: [execution timestamp]
Tester: [name]

Input:
- Template: [selected template]
- Modification: [request text or "(empty)"]

Execution:
- Generated file size: [bytes]
- AI modification status: [success/fallback/timeout]
- Download successful: [yes/no]

Import Result:
- Status: [SUCCESS / FAILED]
- Error message (if any): [exact error text]
- Import duration: [seconds]

Verification:
- Template visible in Mx: [yes/no]
- Structure matches expected: [yes/no]
- Functional test (open/navigate): [yes/no]

Issues Found:
[Describe any issues or unexpected behavior]

Notes:
[Additional observations]
```

---

## Test Priority

**Priority 1 (Must Pass):**
- Test 1.2 (baseline-simple clone)
- Test 2.1 (add single phase)
- Test 2.2 (add phase with witness)

**Priority 2 (Should Pass):**
- Test 1.1 (baseline-minimal)
- Test 1.3 (baseline-standard)
- Test 2.3 (multiple sign-offs)
- Test 3.1 (complex template modification)

**Priority 3 (Nice to Have):**
- Test 3.2 (multiple modifications)
- Test 4.1, 4.2, 4.3 (edge cases)

---

## Expected Outcomes Summary

**Best Case:** All tests pass, all templates import successfully, all AI modifications work correctly

**Acceptable:** Priority 1 tests pass, Priority 2/3 may have issues documented for Phase 4.2 fixes

**Blocker:** Priority 1 tests fail - indicates fundamental issue requiring immediate fix

---

## Next Steps After Testing

1. Document all results in `IMPORT-RESULTS.md`
2. For each failure:
   - Capture exact error message from Mx
   - Save failing .mt file for analysis
   - Note whether issue is AI-generated structure or UUID problem
3. Prioritize fixes for Phase 4.2 based on:
   - Priority 1 failures = critical
   - Priority 2 failures = important
   - Priority 3 failures = enhancement

---

*Created: 2026-02-25*
*For: Phase 04 Plan 01 - Testing & Verification*
